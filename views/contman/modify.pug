extends ../layout

block content
	a(href=`${m_page.link}`) #{m_page.name} (#{m_page.comment})
	p #{m_page.create_time.toLocaleString()}
		|  by
		a(href=`/personalpage/?id=${m_author.id}`)  #{m_author.fullname}

	table.table.table-sm.table-dark
		thead
			tr
				form(action=`/filtering placeholders in one page`, method="post")
					th(scope="col") link
					th(scope="col") preview
					th(scope="col") comment

					th(scope="col") origin tif (#{m_author.lan})

					if (`${m_user.id}`!= `${m_author.id}`)
						th(scope="col")
							select.dropdown.custom-select(name="lan" id="landrop" onchange="this.form.submit()")
								if (picked_lan)
									option(value=picked_lan.lan_geo) #{picked_lan.language} (#{picked_lan.country})
								else
									option(value="") language (country)
								each item in m_lan
									option(value=item.lan_geo) #{item.language} (#{item.country})
		tbody
			for row in m_rows
				tr
					td
						a(href=`${row.link}`) #{row.link}
					td
						img.smalimg(src=`${row.link}`)
					td #{row.comment}
					td
						a(href=`/screenshot/?psd_id=${row.psd_id}`) link
						br
						img.smalimg(src=`${row.preview}`)
						br
						| #{row.content}

					if (`${m_user.id}`!= `${m_author.id}`)
						td
							if (row.local_psd_id)
								a(href=`/screenhost/?psd_id=${row.local_psd_id}`) link
								br
								img.smalimg(src=`${row.local_preview}`)
								br
								| #{row.local_content}

							div.dropdown.ml-3
								a.dropdown-toggle(id="chose_tif_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="showdropdown('desdrop')")
									if (row.local_psd_id)
										| Change
									else
										| Define
								div.dropdown-menu(aria-labelledby="chose_tif_dropdown", id="desdrop")
									a.dropdown-item(href='#') use #{m_author.lan}
									a.dropdown-item(href='#') use local
									a.dropdown-item(href='#') chose tif from database
					if (`${m_user.id}`== `${m_author.id}`)
						td
							button.btn.btn-secondary(href="#") alter

	if (`${m_user.id}`== `${m_author.id}`)
		form.mb-2(action="/contman/addplaceholder", method="post")
			input(type="hidden" name="id" value=`${m_page.id}`)
			button.btn.btn-secondary(type="sumbit") add placeholder

		form.mb-2(action="/contman/publish", method="post")
			input(type="hidden" name="id" value=`${m_page.id}`)
			button.btn.btn-secondary(type="sumbit") publish
